<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Mypage">

	<!-- // 주문 내역 list -->
	<select id="order_list" resultType="order">
<!-- 	SELECT DATE_FORMAT(order_date, '%Y-%m-%d') AS order_date, GROUP_CONCAT(order_product_title SEPARATOR ', ') AS product_titles, COUNT(*) AS total_count
	FROM tbl_order
	GROUP BY DATE_FORMAT(order_date, '%Y-%m-%d'), order_no
	ORDER BY order_no DESC -->
	select * from tbl_order where user_id = #{user_id} order by order_date
	</select>

	<!-- // 총 주문 건수 -->
	<select id="order_count" resultType="int">
		select count(order_no) from tbl_order where user_id=#{user_id}
	</select>
	
	<!-- // 주문 확정 -->
	<insert id="insertOrder">
		insert into tbl_order (order_no, order_product_title, order_date, order_cnt, order_total, user_id)
		values (#{order_no}, #{order_product_title}, sysdate, #{order_cnt}, #{order_total}, #{user_id})
	</insert>
	
	<!-- // 주문 상세 추가 -->
	<insert id="insertOrderDetail">
		insert into tbl_order_detail ( order_detail_no, order_no, product_no, order_date, order_detail_pname,order_detail_cnt,order_detail_price,user_id,order_detail_pcont)
		values (order_detail_no_seq.nextval, #{order_no}, #{product_no},sysdate, #{order_detail_pname}, #{order_detail_cnt}, #{order_detail_price},#{user_id},#{order_detail_pcont})
	</insert>
	
	<!-- // 주문상세내역 list -->
	<select id="orderDetail_list" resultType="orderdetail">
		SELECT * FROM tbl_order_detail
		WHERE order_no= #{order_no}
	</select>
	
	<!-- // 찜목록 -->
	<select id="likeP_list" resultType="like">
        <!-- SELECT l.like_no, l.user_id, l.product_no, p.product_title, p.product_price, p.product_date
        FROM tbl_like l
        INNER JOIN tbl_product p ON l.product_no = p.product_no
        WHERE l.user_id = #{user_id, jdbcType=VARCHAR} -->
        select * from tbl_like
	</select>
	
	<!-- // 장바구니 목록 조회 -->
	<select id="cart_list" resultType="cart" >
		select * from tbl_cart where cart_mem_id = #{cart_mem_id}
	</select>
	
	<!-- // 배송지 리스트 조회 -->
	<select id="memAddr_list" resultType="member">
		select * from tbl_member where user_id = #{user_id}
	</select>
	
	<!-- //배송지 추가 -->
	<insert id="addr_in" >
		insert into tbl_addr (addr_no,user_id,postCode, roadAddr, detailAddr,addr_name) 
		values (addr_no_seq.nextval, #{user_id}, #{postCode}, #{roadAddr},#{detailAddr}, #{addr_name})
	</insert>
	
	<!-- //배송지 추가 리스트 조회 -->
	<select id="addr_list" resultType="addr">
		select * from tbl_addr where user_id = #{user_id}
	</select>
	
	<!-- //장바구니 삭제 -->
	<delete id="cart_del">
		delete from tbl_cart where cart_no=#{cart_no}
	</delete>
	
	<!-- //장바구니 전체삭제 -->
	<delete id="cart_delall">
		delete from tbl_cart where cart_mem_id=#{cart_mem_id}
	</delete>
	
	
	<!-- //추가배송지 수정조회 -->
	<select id="selectOneAddr" resultType="addr">
		select * from tbl_addr where addr_no=#{addr_no}
	</select>
	
	
	<!-- //추가배송지 수정 -->
	<update id="updateAddr">
		update tbl_addr set addr_name=#{addr_name}, postCode=#{postCode},
		 roadAddr=#{roadAddr}, detailAddr=#{detailAddr} where addr_no=#{addr_no}
	</update>
	
	
	<!-- //추가 배송지 삭제 -->
	<delete id="deleteAddr">
		delete from tbl_addr where addr_no=#{addr_no}
	</delete>
	
	<!-- //장바구니 체크박스 선택된 정보 조회 -->
	<select id="selectCartItem" resultType="cart">
		select * from tbl_cart where cart_no = #{cart_no}
	</select>
	
	<!-- // 후기 작성 -->
	<insert id="insertReview">
		insert into tbl_reviews
		(re_no, re_pro_no, re_mem_id, re_title, re_content, re_image1, re_image2, re_image3, re_score, re_date)
		values (re_no_seq.nextval, #{re_pro_no}, #{re_mem_id}, #{re_title}, #{re_content}, #{re_image1}, #{re_image2}, #{re_image3}, #{re_score}, sysdate)
	</insert>
	
	<!-- // 리뷰 조회 -->
	<select id="reviewList" resultType="reviews">
		select * from tbl_reviews where re_mem_id = #{re_mem_id}
	</select>
</mapper>

